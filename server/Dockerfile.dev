# Step 1: Use Node as base image (not alpine for dev)
FROM node:20

# Step 2: Set working directory inside container
WORKDIR /app

# Step 3: Copy package files first (better caching)
COPY package*.json ./
COPY prisma ./prisma/

# Step 4: Install dependencies
RUN npm install

# Step 5: Copy everything else
COPY . .

# Step 6: Generate Prisma Client
# RUN npx prisma generate

# Step 7: Expose backend port (NestJS defaults to 3000)
EXPOSE 3000

# Step 8: Run migrations then start in dev mode
CMD ["sh", "-c", "npx prisma generate && npx prisma migrate dev && npm run dev"]