generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id() @default(autoincrement())
  email         String   @unique()
  password      String
  name          String?
  createdAt     DateTime @default(now())
  refreshTokens String[] @default([])

  UserMovieData  UserMovieData[]
  UserMovieEntry UserMovieEntry[]

  @@map("users")
}

model Movies {
  id Int @id()

  UserMovieData  UserMovieData[]
  UserMovieEntry UserMovieEntry[]

  @@map("movies")
}

model UserMovieData {
  id          Int      @id() @default(autoincrement())
  user_id     Int
  movie_id    Int
  rating      Int?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user  User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  movie Movies @relation(fields: [movie_id], references: [id], onDelete: Cascade)

  @@unique([user_id, movie_id])
  @@map("user_movie_data")
}

model UserMovieEntry {
  id     Int      @id() @default(autoincrement())
  user_id     Int
  movie_id   Int
  status    MovieStatus
  createdAt  DateTime @default(now())

  user  User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  movie Movies @relation(fields: [movie_id], references: [id], onDelete: Cascade)

  @@unique([user_id, movie_id])
  @@map("user_movie_entries")

}

enum MovieStatus {
  WATCHED
  PLANNED
}

